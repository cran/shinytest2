<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Using shinytest2 with R packages</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Using shinytest2 with R packages</h1>



<p>For R packages that have Shiny applications, there are generally two
ways that the applications will be present in the package. The first is
to have an <code>app.R</code> in a subdirectory of <code>inst/</code>.
The second way is to have a function which returns a Shiny app
object.</p>
<!-- See https://github.com/rstudio/shinytestPackageExample for an example package. This document closely mirrors the content of that package: it explains how to set up tests for both types of applications, and then has a section that describes some setup tasks that are common to both types. -->
<blockquote>
<p>ðŸš§ Using <code>{chromote}</code> in CRAN tests</p>
<p><code>{chromote}</code> utilizes the Google Chrome application
installed on testing machines, which can change over time. CRAN has
requested that no package utilize <code>{chromote}</code>â€™s
functionality when testing on CRAN. This is because the package may not
work as expected if the version of Google Chrome changes.</p>
<p>To address this, <code>{shinytest2}</code> will call
<code>testthat::skip_on_cran()</code> when creating an
<code>AppDriver</code> during CRAN testing.</p>
<p>To learn more about CRANâ€™s reasoning and how to test your package
using CI, please visit <code>{chromote}</code>â€™s <a href="https://rstudio.github.io/chromote/articles/example-cran-tests.html">Using
<code>{chromote}</code> in CRAN tests</a>.</p>
</blockquote>
<div id="applications-defined-in-another-file" class="section level2">
<h2>Applications defined in another file</h2>
<p>Placing your Shiny application in a subdirectory of
<code>inst/</code> is a common and clean way to include Shiny
applications in R packages.</p>
<pre><code>/
â”œâ”€â”€ DESCRIPTION
â”œâ”€â”€ NAMESPACE
â”œâ”€â”€ R
â”œâ”€â”€ inst
â”‚   â””â”€â”€ sample_app
â”‚       â”œâ”€â”€ app.R
â””â”€â”€ tests
    â”œâ”€â”€ testthat
    â”‚   â”œâ”€â”€ _snaps
    â”‚   â”‚   â””â”€â”€ sample_app
    â”‚   â”‚       â””â”€â”€ 001.json
    â”‚   â””â”€â”€ test-sample_app.R
    â””â”€â”€ testthat.R</code></pre>
<p>When recording tests for this application, <code>record_test()</code>
will save the test files in the packageâ€™s <code>tests/testthat/</code>
directory. This doesnâ€™t clutter the application directory with test
files and leverages existing package testing infrastructure for a
unified testing experience.</p>
<p>Within each test file, supply the application directory to
<code>AppDriver$new()</code>. For example, in
<code>tests/testthat/test-sample_app.R</code>, you would have:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># File: tests/testthat/test-sample_app.R</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">library</span>(shinytest2)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;sample_app works&quot;</span>, {</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="co"># Don&#39;t run these tests on the CRAN build servers</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="fu">skip_on_cran</span>()</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  appdir <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="at">package =</span> <span class="st">&quot;exPackage&quot;</span>, <span class="st">&quot;sample_app&quot;</span>)</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(appdir, <span class="at">name =</span> <span class="st">&quot;sample_app&quot;</span>)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">expect_values</span>()</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>})</span></code></pre></div>
<p>If the application directory is not meant to be public, it can also
be located in <code>./tests/testthat/apps</code>.
<code>{shinytest2}</code> does this with many application and has
<code>appdir</code> above point to the relative path to the application.
<code>app_dir &lt;- testthat::test_path(&quot;apps/sample_app&quot;)</code>.</p>
</div>
<div id="applications-using-a-function" class="section level2">
<h2>Applications using a function</h2>
<p>Some packages, such as <code>{golem}</code>, provide a function that
runs or returns a shiny application. In this case, you can create a
wrapper function to perform two actions: load the package via
<code>library()</code> or <code>require()</code> and returns/runs an
app. For example, if your package is named <code>mypkg</code>, your
package structure may look like:</p>
<pre><code>/
â”œâ”€â”€ .Rbuildignore
â”œâ”€â”€ DESCRIPTION
â”œâ”€â”€ NAMESPACE
â”œâ”€â”€ R
â”‚   â””â”€â”€ run-app.R
â””â”€â”€ tests
    â”œâ”€â”€ testthat
    â”‚   â”œâ”€â”€ _snaps
    â”‚   â”‚   â””â”€â”€ app-function
    â”‚   â”‚       â””â”€â”€ 001.json
    â”‚   â””â”€â”€ test-app-function.R
    â””â”€â”€ testthat.R</code></pre>
<p>and the function that runs the app is <code>run_app()</code>, you can
pass in functions defined within your R package directly to
<code>AppDriver$new()</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># File: tests/testthat/test-app-function.R</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">library</span>(shinytest2)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;mypkg app initial values are consistent&quot;</span>, {</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="co"># Don&#39;t run these tests on the CRAN build servers</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="fu">skip_on_cran</span>()</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(run_app, <span class="at">name =</span> <span class="st">&quot;mypkg-app&quot;</span>)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">expect_values</span>()</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>})</span></code></pre></div>
<p>This works as <code>{shinytest2}</code> recognizes that the
<code>run_app</code> function is part of the local package. When running
a local package methods, <code>{shinytest2}</code> will call the method
within the scope of your local R package in the the background
process.</p>
<p>The specially handled function is functionally equivalent to defining
a wrapper function that loads the package and calls
<code>run_app()</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># File: tests/testthat/test-app-function.R</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">library</span>(shinytest2)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>run_mypkg_app <span class="ot">&lt;-</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;mypkg app initial values are consistent&quot;</span>, {</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="co"># Don&#39;t run these tests on the CRAN build servers</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="fu">skip_on_cran</span>()</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">name =</span> <span class="st">&quot;mypkg-app&quot;</span>, <span class="cf">function</span>() {</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>    <span class="fu">library</span>(mypkg)</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>    <span class="fu">run_app</span>()</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>  })</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">expect_values</span>()</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>})</span></code></pre></div>
<p>When using a function to initialize the <code>AppDriver</code>,
<code>{shinytest2}</code> will automatically call
<code>pkgload::load_all()</code> when you execute
<code>library(&lt;pkg&gt;)</code> or <code>require(&lt;pkg&gt;)</code>
to load your dev package, <code>&lt;pkg&gt;</code>, in the background R
process. Currently, only the local dev package can be loaded. Similar to
<code>{mirai}</code>, there is also no carryover from the testing
environment to the supplied function execution within the background R
process. All packages may need to be <code>library()</code>â€™ed
again!</p>
</div>
<div id="application-objects" class="section level2">
<h2>Application objects</h2>
<p>The third way have an application in an R package is by having a
function that returns a Shiny application object. App objects being
supplied directly to <code>AppDriver$new()</code> are to be considered
for quick testing / confirmation of targeted behavior. For more complex
applications, it is recommended to use one of the other two approaches
described above as not all global variables and contexts are preserved
when serializing the app object.</p>
<p>In this example, thereâ€™s a function <code>hello_world_app()</code>,
which lives in <code>R/app-object.R</code>:</p>
<pre><code>/
â”œâ”€â”€ .Rbuildignore
â”œâ”€â”€ DESCRIPTION
â”œâ”€â”€ NAMESPACE
â”œâ”€â”€ R
â”‚   â””â”€â”€ app-object.R
â””â”€â”€ tests
    â”œâ”€â”€ testthat
    â”‚   â”œâ”€â”€ _snaps
    â”‚   â”‚   â””â”€â”€ app-object
    â”‚   â”‚       â””â”€â”€ 001.json
    â”‚   â””â”€â”€ test-app-object.R
    â””â”€â”€ testthat.R</code></pre>
<p>The function simply returns an object from
<code>shinyApp()</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># File: R/app-object.R</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>dt <span class="ot">&lt;-</span> datasets<span class="sc">::</span>cars</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>hello_world_app <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="fu">shinyApp</span>(</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    <span class="at">ui =</span> <span class="fu">fluidPage</span>(</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>      <span class="fu">sliderInput</span>(<span class="st">&quot;n&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="dv">1</span>, <span class="fu">nrow</span>(dt), <span class="dv">10</span>),</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;plot&quot;</span>)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    ),</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>    <span class="at">server =</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>      output<span class="sc">$</span>plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>        <span class="fu">plot</span>(</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>          <span class="fu">head</span>(dt, input<span class="sc">$</span>n),</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>          <span class="at">xlim =</span> <span class="fu">range</span>(dt[[<span class="dv">1</span>]]),</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>          <span class="at">ylim =</span> <span class="fu">range</span>(dt[[<span class="dv">2</span>]])</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>        )</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>      })</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>    }</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>  )</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>}</span></code></pre></div>
<p>Once we have the object, it can be supplied directly to
<code>AppDriver$new()</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># File: tests/testthat/test-app-function.R</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;hello-world app initial values are consistent&quot;</span>, {</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="co"># Don&#39;t run these tests on the CRAN build servers</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="fu">skip_on_cran</span>()</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>  shiny_app <span class="ot">&lt;-</span> <span class="fu">hello_world_app</span>()</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(shiny_app, <span class="at">name =</span> <span class="st">&quot;hello&quot;</span>)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">expect_values</span>()</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>})</span></code></pre></div>
<p>To help create tests, you can call <code>record_test()</code> on your
shiny application object directly. Unfortunately, the test file will not
be able to be saved. Instead, the test commands can be copied into a
test script manually.</p>
</div>
<div id="understanding-app-support-files-local_app_support-and-friends" class="section level2">
<h2>Understanding app support files: <code>local_app_support()</code>
and friends</h2>
<p>When testing Shiny applications within R packages, you may need
access to helper functions, modules, or other objects defined in your
appâ€™s <code>./R</code> directory. The <code>local_app_support()</code>,
<code>with_app_support()</code>, and <code>load_app_support()</code>
functions help manage this.</p>
<div id="when-do-you-need-these-functions" class="section level3">
<h3>When do you need these functions?</h3>
<p><strong>You do NOT need them if:</strong></p>
<ul>
<li>Your app is defined inline (as a Shiny app object passed directly to
<code>AppDriver$new()</code>)</li>
<li>All needed functions are already available from your package via
<code>library(yourpackage)</code> or in the test file itself</li>
</ul>
<p><strong>Example - inline app (no <code>local_app_support()</code>
needed):</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># File: tests/testthat/test-inline-app.R</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">library</span>(shinytest2)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;inline app with package modules works&quot;</span>, {</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="fu">skip_on_cran</span>()</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  </span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  <span class="co"># Your module functions are already available from your package</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>  test_app <span class="ot">&lt;-</span> <span class="fu">shinyApp</span>(</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>    <span class="at">ui =</span> <span class="fu">fluidPage</span>(<span class="fu">mod_test_ui</span>(<span class="st">&quot;test&quot;</span>)),</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>    <span class="at">server =</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>      <span class="fu">mod_test_server</span>(<span class="at">id =</span> <span class="st">&quot;test&quot;</span>)</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>    }</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>  )</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>  </span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(test_app)</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">expect_values</span>()</span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>})</span></code></pre></div>
<p><strong>You DO need them if:</strong></p>
<ul>
<li>Your app is stored in a directory (e.g.,
<code>inst/myapps/app1/</code>)</li>
<li>The app has supporting files in its own <code>./R</code>
subfolder</li>
<li>You need to test those supporting functions or access them in your
tests</li>
</ul>
</div>
<div id="which-function-should-you-use" class="section level3">
<h3>Which function should you use?</h3>
<p><strong><code>local_app_support(app_dir)</code></strong> -
Recommended for package testing</p>
<ul>
<li>Automatically attaches the appâ€™s support environment for the current
test</li>
<li>Automatically cleans up when the test completes</li>
<li>Prevents conflicts between different app tests</li>
</ul>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># File structure:</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co">#   ./inst/myapps/app1/app.R</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">#   ./inst/myapps/app1/R/modules.R  (contains helper functions)</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#   ./tests/testthat/test-app1.R</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;app1 works with its helpers&quot;</span>, {</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  <span class="fu">skip_on_cran</span>()</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  </span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>  app_dir <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;myapps/app1&quot;</span>, <span class="at">package =</span> <span class="st">&quot;mypkg&quot;</span>)</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>  </span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>  <span class="co"># Load app1&#39;s support files (modules.R, etc.)</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>  <span class="fu">local_app_support</span>(app_dir)</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>  </span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>  <span class="co"># Now helper functions from app1/R/ are available</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">exists</span>(<span class="st">&quot;my_module_ui&quot;</span>))</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>  </span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>  <span class="co"># Test the app</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(app_dir)</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">expect_values</span>()</span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>})</span></code></pre></div>
<p><strong><code>with_app_support(app_dir, { ... })</code></strong> -
For explicit scoping</p>
<ul>
<li>Support environment is only available within the expression
block</li>
<li>Cleaned up immediately after the expression completes</li>
<li>Useful when you want very clear boundaries</li>
</ul>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;app support is scoped correctly&quot;</span>, {</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  app_dir <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;myapps/app1&quot;</span>, <span class="at">package =</span> <span class="st">&quot;mypkg&quot;</span>)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  </span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="fu">expect_false</span>(<span class="fu">exists</span>(<span class="st">&quot;helper_value&quot;</span>))</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  </span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  <span class="fu">with_app_support</span>(app_dir, {</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    <span class="co"># helper_value is available here</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>    <span class="fu">expect_true</span>(<span class="fu">exists</span>(<span class="st">&quot;helper_value&quot;</span>))</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>    <span class="fu">expect_equal</span>(helper_value, <span class="dv">42</span>)</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>  })</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>  </span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>  <span class="co"># helper_value is gone after the block</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>  <span class="fu">expect_false</span>(<span class="fu">exists</span>(<span class="st">&quot;helper_value&quot;</span>))</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>})</span></code></pre></div>
<p><strong><code>load_app_support(app_dir)</code></strong> - For
standalone apps only</p>
<ul>
<li>Permanently loads support files into the testing environment</li>
<li>No automatic cleanup</li>
<li>Best used in <code>setup-shinytest2.R</code> for non-package Shiny
applications</li>
<li><strong>Not recommended for package testing</strong> as it can cause
conflicts</li>
</ul>
</div>
<div id="benefits-of-using-these-functions" class="section level3">
<h3>Benefits of using these functions</h3>
<ol style="list-style-type: decimal">
<li><strong>Isolation</strong>: Tests for different apps donâ€™t interfere
with each other</li>
<li><strong>Access to internals</strong>: Test helper functions and
modules without manual sourcing</li>
<li><strong>Clean testing</strong>: Automatic cleanup prevents pollution
of test environment</li>
<li><strong>Package compatibility</strong>: Works seamlessly with
package development workflow</li>
</ol>
</div>
</div>
<div id="other-setup-steps" class="section level2">
<h2>Other setup steps</h2>
<p>There are a few steps that are needed for both types of tests.</p>
<p>It is recommended to call <code>shinytest2::use_shinytest2()</code>
to enable different test config set-ups.</p>
<p>You will need to add <code>{shinytest2}</code> to the
<code>Suggests</code> section in your <code>DESCRIPTION</code> file.</p>
<pre><code>Suggests:
    shinytest2</code></pre>
<p>When all of these items are in place, you can test your package using
<code>testthat::test_local()</code> or by running
<code>R CMD check</code> on your package. If you are using the RStudio
IDE, you can also run Build -&gt; Test Package or Build -&gt; Check
Package.</p>
<p><code>{shinytest2}</code> <strong>no longer</strong> requires that
your package to be <em>installed</em> when testing. It will load from
your local path. <a href="https://testthat.r-lib.org/reference/test_package.html"><code>testthat::test_local()</code></a>
(and related wrappers) eventually call <code>pkgload::load_all()</code>
to temporarily source the local R package in the foreground for unit
testing. <code>{shinytest2}</code> has made the stance that App authors
<strong>must</strong> call <code>library(&lt;pkg&gt;)</code> or
<code>require(&lt;pkg&gt;)</code> on their package within their App.
This ensures that the package is loaded in the background R process that
runs the Shiny application. When <code>library*()</code> is called,
<code>{shinytest2}</code> will automatically execute
<code>pkgload::load_all()</code> to load the packageâ€™s source code.</p>
</div>
<div id="how-should-i-test-multiple-applications" class="section level2">
<h2>How should I test multiple applications?</h2>
<p>Given you have multiple applications / app functions in your package,
you can create multiple test files in <code>tests/testthat/</code>, one
for each application. Each test file can create its own
<code>AppDriver</code> instance for the specific application being
tested.</p>
<p>It is not recommended to utilize <code>test_app(&quot;path/to/app&quot;)</code>
within package testing as we want the tests to be controlled by the
packageâ€™s <code>testthat</code> infrastructure. This allows for more
flexibility and control over how your applications are tested while your
current packageâ€™s testthat infrastructure.</p>
<p>Good: * Supply a function from within your package to
<code>AppDriver$new()</code> and test within your packageâ€™s
<code>testthat::test_that()</code> tests. * Supply an application
directory within your package to <code>AppDriver$new()</code> and test
within your packageâ€™s <code>testthat::test_that()</code> tests. Bad: *
Call <code>test_app(&quot;path/to/app&quot;)</code> within your packageâ€™s
<code>testthat::test_that()</code> tests.</p>
<p>This keeps your snaps all in one place and not scattered across
multiple application directories.</p>
</div>
<div id="migrating-from-shinytest-v0.4.0-to-v0.5.0" class="section level2">
<h2>Migrating from shinytest v0.4.0 to v0.5.0</h2>
<p>Previously, it was encouraged to store tests within the application
directory itself. This made sense when applications were primarily
standalone. However, for R packages, it is more idiomatic to store tests
in the <code>tests/testthat/</code> directory and utilize an app that is
defined elsewhere (either in <code>inst/</code> or another
directory).</p>
<p>Previous file structure:</p>
<pre><code>/
â”œâ”€â”€ DESCRIPTION
â”œâ”€â”€ NAMESPACE
â”œâ”€â”€ R
â”œâ”€â”€ inst
â”‚   â””â”€â”€ sample_app
â”‚       â”œâ”€â”€ app.R
â”‚       â”œâ”€â”€ R
â”‚       â”‚   â””â”€â”€ helpers.R
â”‚       â””â”€â”€ tests
â”‚           â”œâ”€â”€ testthat.R
â”‚           â””â”€â”€ testthat
â”‚              â”œâ”€â”€ setup-shinytest2.R
â”‚              â””â”€â”€ test-sample_app.R
â””â”€â”€ tests
    â”œâ”€â”€ testthat.R
    â””â”€â”€ testthat
        â””â”€â”€ test-other-things.R</code></pre>
<p>Previous <code>test-sample_app.R</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">library</span>(shinytest2)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;sample_app works&quot;</span>, {</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">name =</span> <span class="st">&quot;sample_app&quot;</span>)</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">expect_values</span>()</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>  <span class="fu">expect_equal</span>(app<span class="sc">$</span><span class="fu">get_value</span>(<span class="st">&quot;input$n&quot;</span>), helper_value)</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>})</span></code></pre></div>
<p>It is now recommended to store all tests in
<code>tests/testthat/</code> and have the application defined elsewhere.
This keeps the application directory clean and leverages existing
package testing infrastructure for a unified testing experience.</p>
<p>New file structure:</p>
<pre><code>/
â”œâ”€â”€ DESCRIPTION
â”œâ”€â”€ NAMESPACE
â”œâ”€â”€ R
â”œâ”€â”€ inst
â”‚   â””â”€â”€ sample_app
â”‚       â”œâ”€â”€ app.R
â”‚       â”œâ”€â”€ R
â”‚           â””â”€â”€ helpers.R
â””â”€â”€ tests
    â”œâ”€â”€ testthat.R
    â””â”€â”€ testthat
        â”œâ”€â”€ test-other-things.R
        â””â”€â”€ test-sample_app.R</code></pre>
<p>New <code>test-sample_app.R</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">library</span>(shinytest2)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">&quot;sample_app works&quot;</span>, {</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  appdir <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="at">package =</span> <span class="st">&quot;exPackage&quot;</span>, <span class="st">&quot;sample_app&quot;</span>)</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>  <span class="fu">local_app_support</span>(appdir)</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(appdir, <span class="at">name =</span> <span class="st">&quot;sample_app&quot;</span>)</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">expect_values</span>()</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>  <span class="fu">expect_equal</span>(app<span class="sc">$</span><span class="fu">get_value</span>(<span class="st">&quot;input$n&quot;</span>), helper_value)</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>})</span></code></pre></div>
<p>Since we have moved the tests out of the application directory, we
need to ensure that any supporting files (like snapshots) are still
accessible. When testing <strong>only</strong> an application, the
premise is similar to a package where all supporting files should be
available in the testing environment. However, within a package, the
application is a means to test the package and should not automatically
load supporting files into the entire testing environment, possibly
causing conflicts with other Shiny applications or tests.</p>
<p>To address this, we use <code>local_app_support(appdir)</code> to
temporarily link the necessary support files from the application
directory to the test environment. This ensures that the tests can
access the required snapshots and other supporting files without
cluttering the application directory itself.</p>
</div>
<div id="continuous-integration" class="section level2">
<h2>Continuous integration</h2>
<p>If you would like your package to be tested with every commit, you
can set it up with GitHub Actions. Please see <a href="./use-ci.html">Using shinytest2 with continuous integration</a>
for inspiration.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
